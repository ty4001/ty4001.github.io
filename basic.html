<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ESPN Headlines — Signage</title>
<style>
  :root {
    --bg: #0b0b0b; --card: #141414; --text: #f5f5f5; --muted:#bcbcbc; --accent:#ff0033;
    --pad: 3.5vmin; --radius: 20px; --gap: 2.5vmin; --w: min(92vw, 1400px);
    --slide-ms: 650; /* fade animation */
  }
  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, Arial, sans-serif; }
  .wrap { height: 100%; display: grid; place-items: center; }
  .stage { width: var(--w); height: min(92vh, 850px); position: relative; border-radius: var(--radius); overflow: hidden; border: 1px solid #222; background: linear-gradient(180deg,#101010,#0c0c0c); }
  header.bar {
    position:absolute; top:0; left:0; right:0; display:flex; align-items:center; gap:1rem;
    padding: 12px var(--pad); background: linear-gradient(0deg, transparent, rgba(0,0,0,.35));
  }
  header.bar img { height: 26px; }
  header.bar h1 { font-size: 1.1rem; margin:0; letter-spacing:.2px; font-weight:600; }
  .slides { position:absolute; inset: 0; }
  .slide {
    position:absolute; inset:0; opacity:0; transform: scale(1.015);
    transition: opacity var(--slide-ms)ms ease, transform var(--slide-ms)ms ease;
    display:grid; grid-template-rows: 62% 38%; background: var(--card);
  }
  .slide.active { opacity:1; transform: scale(1); }
  .media { position:relative; background:#111; display:grid; place-items:center; overflow:hidden; }
  .media img, .media video { width:100%; height:100%; object-fit: cover; display:block; }
  .badge {
    position:absolute; right:12px; bottom:12px; background: rgba(0,0,0,.6); backdrop-filter: blur(3px);
    color:#fff; font-size:.9rem; padding:.3rem .55rem; border-radius: 999px; border:1px solid rgba(255,255,255,.15);
  }
  .meta {
    padding: 0 var(--pad);
    display:flex; align-items:center; gap:12px; height: 3rem; opacity:.8; font-size:.95rem;
  }
  .dot { width:6px; height:6px; border-radius:50%; background:var(--muted); }
  .body {
    padding: 0 var(--pad) var(--pad); display:grid; grid-template-rows: auto 1fr; gap: 1.2vmin;
  }
  .title { font-size: clamp(1.2rem, 2.6vmin, 2rem); line-height:1.2; margin: 0; font-weight: 700; }
  .desc { font-size: clamp(.95rem, 1.8vmin, 1.15rem); opacity:.92; }
  .progress {
    position:absolute; left:0; right:0; bottom:0; height:6px; background: rgba(255,255,255,.08);
  }
  .progress > div {
    height:100%; width:0%; background: var(--accent);
    transition: width linear;
  }
  .footer {
    position:absolute; right: var(--pad); bottom: 10px; font-size:.9rem; opacity:.7;
  }
  a.cardlink { color: inherit; text-decoration: none; }
  .pill {
    position:absolute; left: var(--pad); bottom: 10px;
    background: rgba(255,255,255,.08); color:#fff; padding:.25rem .55rem; border-radius:999px; font-size:.9rem;
    border: 1px solid rgba(255,255,255,.12);
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="stage" id="stage" role="region" aria-label="ESPN Headlines">
    <header class="bar">
      <img src="https://a.espncdn.com/favicon.ico" alt="ESPN">
      <h1>ESPN Top Headlines</h1>
    </header>

    <div class="slides" id="slides" aria-live="polite"></div>

    <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>
    <div class="pill">Auto-advance</div>
    <div class="footer">Content © ESPN — click to read on ESPN.com</div>
  </div>
</div>

<script>
  // === CONFIG (tweak without editing code elsewhere) =========================
  const RSS_URL = "https://www.espn.com/espn/rss/news";
  const ITEMS_MAX = 10;          // number of items to rotate
  const SLIDE_SECONDS = 10;      // per-card dwell time
  const REFRESH_MINUTES = 10;    // how often to refresh the feed

  // Use a simple RSS→JSON gateway. For a private proxy, point API_URL to your Cloudflare Worker: 
  // e.g.  const API_URL = "https://YOURWORKER.workers.dev/?rss=" + encodeURIComponent(RSS_URL);
  const API_URL = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(RSS_URL);

  // ===========================================================================
  const slidesEl = document.getElementById("slides");
  const progressEl = document.getElementById("progressBar");
  let timer = null, idx = 0, dataItems = [];

  const safeHTML = (s="") => s.replaceAll(/</g,"&lt;").replaceAll(/>/g,"&gt;");

  function findImage(item) {
    if (item.thumbnail) return item.thumbnail;
    if (item.enclosure && item.enclosure.link && (item.enclosure.type || "").startsWith("image"))
      return item.enclosure.link;
    // As a last resort, pull first <img> in description
    const p = document.createElement("div");
    p.innerHTML = item.description || "";
    const img = p.querySelector("img");
    return img?.src || null;
  }

  function niceDate(s) {
    if (!s) return "";
    const d = new Date(s);
    if (isNaN(d)) return "";
    return d.toLocaleString(undefined, { dateStyle:"medium", timeStyle:"short" });
  }

  function renderSlides(items) {
    slidesEl.innerHTML = "";
    items.forEach((it, i) => {
      const a = document.createElement("a");
      a.className = "slide";
      a.href = it.link;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.setAttribute("data-index", i);
      a.classList.toggle("active", i === 0);

      const imgUrl = findImage(it);
      const media = document.createElement("div");
      media.className = "media";
      media.innerHTML = imgUrl
        ? `<img src="${imgUrl}" alt="" loading="lazy">`
        : `<div style="opacity:.6">No image</div>`;
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = "Photo";
      media.appendChild(badge);

      const body = document.createElement("div");
      body.innerHTML = `
        <div class="meta">
          <span>${niceDate(it.pubDate) || "Latest"}</span>
          <span class="dot"></span>
          <span>ESPN</span>
        </div>
        <div class="body">
          <h2 class="title">${safeHTML(it.title || "")}</h2>
          <div class="desc">${it.description || ""}</div>
        </div>
      `;

      a.appendChild(media);
      a.appendChild(body);
      slidesEl.appendChild(a);
    });
  }

  function startRotation() {
    clearInterval(timer);
    const dur = SLIDE_SECONDS * 1000;
    progressEl.style.transitionDuration = dur + "ms";
    progressEl.style.width = "0%";
    // small tick to restart CSS transition
    requestAnimationFrame(() => requestAnimationFrame(() => progressEl.style.width = "100%"));

    timer = setInterval(() => {
      const slides = Array.from(document.querySelectorAll(".slide"));
      if (!slides.length) return;
      slides[idx]?.classList.remove("active");
      idx = (idx + 1) % slides.length;
      slides[idx]?.classList.add("active");

      // reset progress bar
      progressEl.style.transition = "none";
      progressEl.style.width = "0%";
      requestAnimationFrame(() => {
        progressEl.style.transition = `width ${dur}ms linear`;
        progressEl.style.width = "100%";
      });
    }, dur);
  }

  async function loadFeed() {
    try {
      const res = await fetch(API_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("Feed fetch failed");
      const json = await res.json();
      dataItems = (json.items || []).slice(0, ITEMS_MAX);
      idx = 0;
      renderSlides(dataItems);
      startRotation();
    } catch (e) {
      console.error(e);
      slidesEl.innerHTML = `<div style="display:grid;place-items:center;height:100%;opacity:.8">Unable to load ESPN feed.</div>`;
      clearInterval(timer);
    }
  }

  // keyboard shortcuts (optional for testing)
  document.addEventListener("keydown", e => {
    const slides = Array.from(document.querySelectorAll(".slide"));
    if (!slides.length) return;
    if (e.key === "ArrowRight") {
      slides[idx]?.classList.remove("active");
      idx = (idx + 1) % slides.length;
      slides[idx]?.classList.add("active");
    } else if (e.key === "ArrowLeft") {
      slides[idx]?.classList.remove("active");
      idx = (idx - 1 + slides.length) % slides.length;
      slides[idx]?.classList.add("active");
    }
  });

  loadFeed();
  setInterval(loadFeed, REFRESH_MINUTES * 60 * 1000);
</script>
</body>
</html>
